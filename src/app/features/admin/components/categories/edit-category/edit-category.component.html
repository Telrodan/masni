<ng-container *ngIf="!isLoading; else loading">
    <ng-container *ngIf="category$ | async as category; else loading">
        <div class="nyk-edit-category-header">Kategória módosítás</div>

        <form class="nyk-edit-category-form" [formGroup]="editCategoryForm">
            <div class="form-group">
                <p-badge
                    *ngIf="category.type === CategoryType.PRODUCT_CATEGORY"
                    value="Termék kategória"
                    severity="success"
                    styleClass="mb-1">
                </p-badge>

                <p-badge
                    *ngIf="category.type === CategoryType.PRODUCT_CATEGORY"
                    [value]="
                        category.isSubCategory ? 'Alkategória' : 'Főkategória'
                    "
                    severity="warning">
                </p-badge>

                <p-badge
                    *ngIf="category.type === CategoryType.MATERIAL_CATEGORY"
                    value="Minta kategória"
                    severity="warning"
                    size="large">
                </p-badge>

                <p-badge
                    *ngIf="category.type === CategoryType.INSPIRATION_CATEGORY"
                    value="Inspiració kategória"
                    size="large">
                </p-badge>
            </div>

            <div class="form-group">
                <label for="name"> Kategória neve </label>

                <input
                    id="name"
                    formControlName="name"
                    type="text"
                    pInputText />
            </div>

            <div
                *ngIf="category.type === CategoryType.PRODUCT_CATEGORY"
                class="form-group">
                <label for="description"> Kategória leírása </label>

                <textarea
                    rows="5"
                    cols="30"
                    pInputTextarea
                    [autoResize]="true"
                    formControlName="description"></textarea>
            </div>

            <div class="form-group">
                <label>Kategória képe</label>

                <p-button
                    *ngIf="!imagePreview"
                    icon="pi pi-image"
                    styleClass="p-button p-button-secondary"
                    (click)="imagePicker.click()">
                </p-button>

                <button
                    *ngIf="imagePreview"
                    pButton
                    pRipple
                    pTooltip="Kép törlése"
                    tooltipPosition="bottom"
                    (click)="onImageClear(imagePicker)"
                    type="button"
                    icon="pi pi-times"
                    class="p-button p-button-danger p-button mb-2"></button>

                <input
                    id="imagePicker"
                    type="file"
                    class="hidden"
                    #imagePicker
                    (change)="onImagePicked($event)" />

                <img
                    *ngIf="imagePreview"
                    class="image-preview border-round"
                    [src]="imagePreview"
                    alt="Kategória" />

                <img
                    *ngIf="!imagePreview"
                    class="mt-2 image-preview border-round"
                    src="../../../../../../assets/images/no-image.png"
                    alt="Kategória" />
            </div>

            <p-button
                label="Módosítás"
                styleClass="p-button w-full mb-3"
                [disabled]="!editCategoryForm.dirty || !editCategoryForm.valid"
                (click)="onEditCategory()">
            </p-button>
        </form>

        <div class="nyk-edit-category-header">Kategória előzmények</div>

        <span class="text-blue-500">
            Hozzáadva:
            {{ category.createdAt | date : "yyy, MMM dd '-' hh:mm a" }}
        </span>

        <span class="text-green-500 block mb-4">
            Utoljára módosítva:
            {{ category.updatedAt | date : "yyy, MMM dd '-' hh:mm a" }}
        </span>

        <p-table class="nyk-edit-category-history" [value]="category.logs">
            <ng-template pTemplate="header">
                <tr>
                    <th>Modul</th>
                    <th>Dátum</th>
                    <th>Üzenet</th>
                    <th>Felhasználó</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-log>
                <tr>
                    <td>{{ log.meta.module }}</td>
                    <td>
                        {{ log.timestamp | date : "yyy, MMM dd '-' hh:mm a" }}
                    </td>
                    <td>{{ log.message }}</td>
                    <td>{{ log.meta.user }}</td>
                </tr>
            </ng-template>
        </p-table>
    </ng-container>
</ng-container>

<ng-template #loading>
    <nyk-spinner></nyk-spinner>
</ng-template>
