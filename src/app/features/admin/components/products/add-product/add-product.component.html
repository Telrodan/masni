<ng-container *ngIf="!isLoading; else loading">
  <div class="font-medium text-2xl text-900">Termék hozzáadás</div>
  <p-divider styleClass="mb-5"></p-divider>

  <form [formGroup]="addProductForm">
    <div class="form-group">
      <label for="name" class="block font-medium text-900 mb-2 text-lg">
        Termék neve
      </label>

      <input id="name" type="text" formControlName="name" pInputText />
    </div>

    <div
      class="form-group"
      *ngIf="productSubCategories$ | async as productSubCategories">
      <label for="categoryId" class="block font-medium text-900 mb-2 text-lg">
        Termék kategória
      </label>

      <p-dropdown
        id="categoryId"
        formControlName="categoryId"
        [options]="productSubCategories"
        placeholder="Válassz egy kategóriát"
        optionValue="id"
        optionLabel="slug"
        styleClass="w-full">
      </p-dropdown>
    </div>

    <div class="form-group">
      <label
        for="shortDescription"
        class="block font-medium text-900 mb-2 text-lg">
        Termék rövid leírás
      </label>

      <input
        id="shortDescription"
        formControlName="shortDescription"
        type="text"
        pInputText />
    </div>

    <div class="form-group">
      <label for="description" class="block font-medium text-900 mb-2 text-lg">
        Termék leírás
      </label>

      <p-editor
        formControlName="description"
        [style]="{ height: '320px' }"></p-editor>
    </div>

    <div class="form-group">
      <label for="price" class="block font-medium text-900 mb-2 text-lg">
        Termék ára
      </label>

      <input id="price" formControlName="price" type="number" pInputText />
    </div>

    <div class="form-group">
      <label
        for="discountedPrice"
        class="block font-medium text-900 mb-2 text-lg">
        Termék akciós ára
      </label>

      <input
        id="discountedPrice"
        formControlName="discountedPrice"
        type="number"
        pInputText />
    </div>

    <div class="form-group">
      <label for="stock" class="block font-medium text-900 mb-2 text-lg">
        Készleten
      </label>

      <input id="stock" formControlName="stock" type="number" pInputText />
    </div>

    <div class="form-group">
      <label
        for="selectedQuestion"
        class="block font-medium text-900 mb-2 text-lg">
        Kérdések
      </label>

      <div class="questions-wrapper">
        <p-dropdown
          id="selectedQuestion"
          formControlName="selectedQuestion"
          [options]="questions$ | async"
          placeholder="Válassz egy kérdést"
          optionValue="id"
          optionLabel="name"
          styleClass="w-full">
        </p-dropdown>

        <p-button
          icon="pi pi-plus"
          styleClass="p-button-success ml-2"
          pTooltip="Kérdés hozzáadása"
          tooltipPosition="bottom"
          (click)="addQuestion()"></p-button>
      </div>
    </div>

    <ng-container *ngIf="selectedQuestions.length">
      <div class="form-group w-6">
        <h3 class="font-medium text-blue-500 mb-1">Választott kérdések</h3>

        <div
          class="option-wrapper mb-2"
          *ngFor="let question of selectedQuestions; let i = index">
          <p class="block font-medium text-800 mb-1">
            {{ i + 1 }}. {{ question.name }}
          </p>

          <p-button
            icon="pi pi-times"
            styleClass="p-button-danger"
            (click)="deleteQuestion(question.id, i)">
          </p-button>
        </div>
      </div>
    </ng-container>

    <div class="form-group">
      <label class="block font-medium text-900 mb-2 text-lg">
        Egyedi termék
      </label>

      <p-inputSwitch formControlName="isCustom"></p-inputSwitch>
    </div>

    <ng-container *ngIf="addProductForm.value.isCustom">
      <div
        *ngIf="inspirationCategories$ | async as inspirationCategories"
        class="form-group">
        <label
          for="inspirationCategoryId"
          class="block font-medium text-900 mb-2 text-lg">
          Inspiráció kategória
        </label>

        <p-dropdown
          id="inspirationCategoryId"
          formControlName="inspirationCategoryId"
          [options]="inspirationCategories"
          placeholder="Válassz egy kategóriát"
          optionValue="id"
          optionLabel="name"
          styleClass="w-full">
        </p-dropdown>
      </div>
    </ng-container>

    <div class="form-group">
      <label class="block font-medium text-900 mb-2 text-lg">Babaruha</label>

      <p-inputSwitch formControlName="isDollDress"></p-inputSwitch>
    </div>

    <div class="form-group">
      <label class="block font-medium text-900 mb-2 text-lg">
        Öltöztethető
      </label>

      <p-inputSwitch formControlName="isDressable"></p-inputSwitch>
    </div>

    <div class="form-group">
      <label class="block font-medium text-900 mb-2 text-lg">
        Kiemelt termék
      </label>

      <p-inputSwitch formControlName="isFeatured"></p-inputSwitch>
    </div>

    <div class="form-group">
      <label
        for="isNameEmbroideryAvailable"
        class="block font-medium text-900 mb-2 text-lg">
        Név hímzés elérhető
      </label>

      <p-inputSwitch
        formControlName="isNameEmbroideryAvailable"></p-inputSwitch>
    </div>

    <div class="form-group">
      <label for="images" class="block font-medium text-900 mb-2 text-lg">
        Termék képek (az első kép lesz mindig a nagy kép)
      </label>

      <p-button
        *ngIf="imagesPreview.length === 0; else clearImagesButton"
        icon="pi pi-image"
        styleClass="p-button p-button-secondary"
        (click)="imagesPicker.click()">
      </p-button>

      <ng-template #clearImagesButton>
        <button
          pButton
          pRipple
          pTooltip="Kép törlése"
          tooltipPosition="bottom"
          (click)="onImageClear(imagesPicker)"
          type="button"
          icon="pi pi-times"
          class="p-button p-button-danger p-button mb-2"></button>
      </ng-template>

      <input
        id="imagesPicker"
        multiple
        type="file"
        class="hidden"
        #imagesPicker
        (change)="onImagePicked($event)" />

      <div
        cdkDropList
        cdkDropListOrientation="horizontal"
        class="nyk-add-product-images-container"
        (cdkDropListDropped)="drop($event)">
        <div
          *ngFor="let image of imagesPreview"
          class="nyk-add-product-image"
          cdkDrag>
          <img [src]="image" />
          <img *cdkDragPreview [src]="image" />
        </div>
      </div>
    </div>
  </form>

  <p-button
    label="Hozzáadás"
    styleClass="p-button w-full"
    [disabled]="!addProductForm.valid"
    (click)="onAddProduct()">
  </p-button>
</ng-container>

<ng-template #loading>
  <nyk-spinner></nyk-spinner>
</ng-template>
